<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Feed</title>
    <style>
        :root {
            --linkedin-blue: #0a66c2;
            --linkedin-light-blue: #e8f3ff;
            --linkedin-bg: #f3f2ef;
            --linkedin-text: #000000;
            --linkedin-secondary-text: #666666;
            --linkedin-border: #e0e0e0;
            --linkedin-card-bg: #ffffff;
            --linkedin-card-shadow: rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--linkedin-bg);
            color: var(--linkedin-text);
            line-height: 1.5;
            padding: 20px 0;
        }

        .linkedin-header {
            background-color: var(--linkedin-card-bg);
            border-bottom: 1px solid var(--linkedin-border);
            padding: 0 16px;
            height: 52px;
            display: flex;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 0 5px var(--linkedin-card-shadow);
        }

        .linkedin-header .logo {
            color: var(--linkedin-blue);
            font-size: 28px;
            margin-right: 20px;
        }

        .feed-container {
            max-width: 550px;
            margin: 60px auto 20px;
        }

        .post-card {
            background-color: var(--linkedin-card-bg);
            border-radius: 8px;
            border: 1px solid var(--linkedin-border);
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: 0 0 0 1px var(--linkedin-card-shadow);
        }

        .embedded-post {
            width: 100%;
            height: 500px;
            border: none;
            margin-bottom: 16px;
        }

        /* Adjust iframe height automatically */
        .iframe-container {
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        .visit-post-btn {
            display: block;
            background-color: var(--linkedin-blue);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 6px 16px;
            margin: 8px auto 16px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .visit-post-btn:hover {
            background-color: #004182;
        }

        /* Loading animation */
        .loading-container {
            display: flex;
            justify-content: center;
            padding: 20px 0;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--linkedin-border);
            border-radius: 50%;
            border-top-color: var(--linkedin-blue);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .load-more-btn {
            display: block;
            background-color: var(--linkedin-card-bg);
            color: var(--linkedin-blue);
            border: 1px solid var(--linkedin-blue);
            border-radius: 16px;
            padding: 8px 20px;
            margin: 20px auto;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .load-more-btn:hover {
            background-color: var(--linkedin-light-blue);
        }

        .fallback-post {
            padding: 16px;
        }

        .fallback-header {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .fallback-profile-image {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
            background-color: #ddd;
            flex-shrink: 0;
        }

        .fallback-info {
            flex: 1;
        }

        .fallback-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--linkedin-text);
            margin-bottom: 2px;
        }

        .fallback-description {
            font-size: 14px;
            color: var(--linkedin-secondary-text);
            margin-bottom: 2px;
        }

        .fallback-time {
            font-size: 12px;
            color: var(--linkedin-secondary-text);
        }

        .fallback-content {
            font-size: 14px;
            white-space: pre-line;
            margin-bottom: 16px;
        }

        .no-posts-message {
            text-align: center;
            padding: 40px 20px;
            background-color: var(--linkedin-card-bg);
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 0 0 1px var(--linkedin-card-shadow);
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .feed-container {
                width: 100%;
                padding: 0 10px;
            }
            
            .embedded-post {
                height: 450px;
            }
        }
    </style>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- LinkedIn-style header -->
    <header class="linkedin-header">
        <div class="logo">
            <i class="fab fa-linkedin"></i>
        </div>
    </header>

    <!-- Main feed container -->
    <div class="feed-container" id="feed-container">
        <!-- Posts will be loaded here -->
    </div>

    <!-- Load more button -->
    <button id="loadMoreBtn" class="load-more-btn">Load More</button>

    <!-- Loading spinner (hidden by default) -->
    <div class="loading-container" id="loading-container" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // Variables to track position
        let fileIndex = 0;
        let elemIndex = 0;

        // Function to create a post element
        function createEmbeddedPost(post) {
            const postCard = document.createElement('div');
            postCard.className = 'post-card';
            

             if (post.embeding_url) {
                // Create an iframe to embed the LinkedIn post
                
                const iframe = document.createElement('iframe');
                iframe.className = 'embedded-post';
                iframe.src = `https://www.linkedin.com/embed/feed/update/${post.embeding_url}`
                iframe.frameBorder = "0";
                iframe.allowFullscreen = true;
                
                // Add the iframe to the post card
                postCard.appendChild(iframe);
            }
            // Fallback to a simple post display if no embed or link
            else {
                const fallbackPost = document.createElement('div');
                fallbackPost.className = 'fallback-post';
                
                fallbackPost.innerHTML = `
                    <div class="fallback-header">
                        <img src="${post.img_link || '/api/placeholder/48/48'}" alt="Profile" class="fallback-profile-image">
                        <div class="fallback-info">
                            <div class="fallback-name">${post.name || 'LinkedIn User'}</div>
                            <div class="fallback-description">${post.description || post.rank || ''}</div>
                            <div class="fallback-time">${post.time_posted || 'Recently'}</div>
                        </div>
                    </div>
                    <div class="fallback-content">${post.post_text || 'No content available'}</div>
                `;
                
                // Add visit post button if we have a link
                if (post.profile_link) {
                    const visitBtn = document.createElement('a');
                    visitBtn.href = post.profile_link;
                    visitBtn.className = 'visit-post-btn';
                    visitBtn.textContent = 'Visit Profile';
                    visitBtn.target = '_blank';
                    fallbackPost.appendChild(visitBtn);
                }
                
                postCard.appendChild(fallbackPost);
                return postCard;
            }
        }

        // Load data function
        function loadData() {
            const loadingContainer = document.getElementById('loading-container');
            const feedContainer = document.getElementById('feed-container');
            
            // Show loading spinner
            loadingContainer.style.display = 'flex';
            
            // Fetch data from server
            fetch('/load_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ file_index: fileIndex, elem_index: elemIndex })
            })
            .then(response => response.json())
            .then(result => {
                // Hide loading spinner
                loadingContainer.style.display = 'none';
                
                // Show message if no posts are found
                if (result.data.length === 0 && fileIndex === 0 && elemIndex === 0) {
                    const noPostsMessage = document.createElement('div');
                    noPostsMessage.className = 'no-posts-message';
                    noPostsMessage.innerHTML = `
                        <h2>No posts found</h2>
                        <p>There are no LinkedIn posts to display. Please run the scraper to collect posts first.</p>
                    `;
                    feedContainer.appendChild(noPostsMessage);
                    
                    // Hide load more button
                    document.getElementById('loadMoreBtn').style.display = 'none';
                    return;
                }
                
                // Add posts to the feed
                result.data.forEach(post => {
                    const postElement = createEmbeddedPost(post);
                    feedContainer.appendChild(postElement);
                });
                
                // Update indices for next load
                fileIndex = result.next;
                elemIndex = result.elem_index;
                
                // Show/hide load more button
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                loadMoreBtn.style.display = (fileIndex !== -1) ? 'block' : 'none';
            })
            .catch(error => {
                console.error('Error loading data:', error);
                loadingContainer.style.display = 'none';
                
                // Show error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'no-posts-message';
                errorMessage.innerHTML = `
                    <h2>Error loading posts</h2>
                    <p>There was a problem loading LinkedIn posts. Please check the server logs.</p>
                `;
                feedContainer.appendChild(errorMessage);
            });
        }

        // Load more button event handler
        document.getElementById('loadMoreBtn').addEventListener('click', loadData);

        // Initial load when page loads
        document.addEventListener('DOMContentLoaded', loadData);

        // Infinite scroll
        window.addEventListener('scroll', () => {
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            
            if (
                window.innerHeight + window.scrollY >= document.body.offsetHeight - 200 &&
                fileIndex !== -1 &&
                loadMoreBtn.style.display !== 'none'
            ) {
                loadData();
            }
        });
    </script>
</body>
</html>